<view class="wrap" style="background: {{themeBg}};">
  <!-- 标题栏 -->
  <view class="header-bar">
    <view class="page-title">收藏</view>
    <view class="stats-text">已收藏：<text class="stats-num">{{favorites.length}}</text> 条</view>
  </view>

  <!-- 搜索与操作 -->
  <view class="search-bar">
    <input class="search-input"
           placeholder="搜索关键词，如 韩系 / 花墙 / 回眸"
           value="{{query}}"
           bindinput="onSearchInput" />
    <button class="refresh-btn" bindtap="onShuffle">
      <image class="refresh-icon" src="/images/换一批推荐.png" mode="aspectFit"></image>
      <text>换一批推荐</text>
    </button>
  </view>

  <!-- 列表 -->
  <view wx:if="{{filtered.length}}" class="card-list">
    <block wx:for="{{filtered}}" wx:key="id">
      <view class="card">
        <image class="cover" src="{{item.cover}}" mode="aspectFill" data-url="{{item.cover}}" bindtap="onPreviewImage"></image>
        <view class="info">
          <!-- 风格标签（所有图片都显示） -->
          <view class="tags">
            <text class="tag-label">风格：</text>
            <text class="tag" wx:for="{{item.tags}}" wx:key="*this">{{item}}</text>
            <text class="tag-empty" wx:if="{{!item.tags || item.tags.length === 0}}">未设置</text>
          </view>
          <view class="actions">
            <button class="btn unfav" data-id="{{item.id}}" bindtap="onToggleFavorite">
              <image class="btn-icon" src="/images/取消.png" mode="aspectFit"></image>
              <text>取消收藏</text>
            </button>
            <button class="btn share" data-id="{{item.id}}" open-type="share">
              <image class="btn-icon" src="/images/分享-copy.png" mode="aspectFit"></image>
              <text>分享</text>
            </button>
            <button class="btn edit" data-id="{{item.id}}" bindtap="onOpenTagEditor">
              <image class="btn-icon" src="/images/编辑.png" mode="aspectFit"></image>
              <text>编辑风格</text>
            </button>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- 空状态：无匹配 -->
  <view wx:elif="{{favorites.length && !filtered.length}}" class="empty">
    <view class="empty-title">无匹配结果</view>
    <view class="empty-tip">换个关键词或切换标签试试～</view>
  </view>

  <!-- 空状态：无收藏 -->
  <view wx:else class="empty">
    <view class="empty-title">还没有收藏</view>
    <view class="empty-tip">去首页挑选姿势建议，点击收藏即可在这里查看哦～</view>
    <navigator class="go-home" open-type="switchTab" url="/pages/index/index">去首页看看</navigator>
  </view>

  <!-- 标签编辑弹层 -->
  <view wx:if="{{showTagEditor}}">
    <view class="mask" bindtap="onCloseTagEditor"></view>
    <view class="sheet">
      <view class="sheet-title">编辑风格</view>
      <view class="sheet-tip">用逗号分隔多个风格标签，如：韩系, 花墙, 回眸</view>
      <input class="sheet-input"
             placeholder="输入标签，逗号分隔"
             value="{{editingTags}}"
             bindinput="onEditTagsInput" />
      <view class="sheet-actions">
        <button class="sheet-btn cancel" bindtap="onCloseTagEditor">取消</button>
        <button class="sheet-btn save" bindtap="onSaveTags">保存</button>
      </view>
    </view>
  </view>
</view>